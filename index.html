<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üéâ Happy Birthday, Grace!</title>
  <style>
    :root{
      --bg1:#0f1020; --bg2:#1d0440; --bg3:#29085f;
      --card:#ffffff10; --card-border:#ffffff30; --text:#f8f8ff;
      --accent:#ffd166; --accent2:#ef476f; --accent3:#06d6a0; --accent4:#118ab2;
    }
    body{
      margin:0; height:100dvh; color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 10% 10%, var(--bg3), transparent),
                  radial-gradient(900px 600px at 90% 20%, var(--bg2), transparent),
                  radial-gradient(1000px 700px at 50% 90%, var(--bg1), transparent),
                  linear-gradient(120deg, #0b1024, #0a0f1f);
      overflow:hidden;
    }
    .stars{position:fixed; inset:0; pointer-events:none; z-index:0;}
    .stars span{position:absolute; width:2px; height:2px; background:#fff9; border-radius:50%;
      animation: twinkle 6s linear infinite var(--delay,0s);
      opacity:.8; filter: drop-shadow(0 0 4px #fff8);
    }
    @keyframes twinkle{ 0%,100%{transform:translateY(0)} 50%{transform:translateY(-8px); opacity:.5} }

    .wrap{ position:relative; z-index:2; display:grid; place-items:center; height:100dvh; padding:24px; }
    .card{
      width:min(880px, 92vw);
      backdrop-filter: blur(12px) saturate(120%);
      background: linear-gradient(180deg, #ffffff18, #ffffff08);
      border:1px solid var(--card-border);
      border-radius:28px; padding:28px; box-shadow: 0 20px 60px #0008;
    }
    h1{font-size: clamp(28px, 5vw, 56px); margin:0 0 12px; letter-spacing:.5px}
    .subtitle{opacity:.85; margin:0 0 16px; font-size:clamp(14px, 2.5vw, 18px)}

    .message{font-weight:700; font-size:clamp(22px, 4.2vw, 40px); line-height:1.2; }
    .caret{ display:inline-block; width:1ch; animation: blink .9s steps(1,end) infinite; }
    @keyframes blink{50%{opacity:0}}

    .controls{display:flex; flex-wrap:wrap; gap:10px; margin:18px 0 10px}
    button{
      border-radius:14px; border:1px solid #ffffff2a; background:#ffffff10; color:var(--text);
      padding:12px 16px; font-size:16px; outline:none; transition:.15s transform, .15s background; cursor:pointer; user-select:none;
    }
    button:hover{ background:#ffffff18; transform: translateY(-1px); }
    .row{display:flex; gap:10px; flex-wrap:wrap}

    .stage{ display:grid; place-items:center; margin:18px 0 8px; }
    svg{ max-width:500px; width:min(90%, 520px); height:auto; }
    .flame{ transform-origin:center; animation: flicker .12s infinite alternate ease-in-out; }
    @keyframes flicker{ from{ transform: scaleY(.9) translateY(0)} to{ transform: scaleY(1.05) translateY(-1px)} }
    .flame.off{ display:none }

    .balloons{ position:fixed; inset:0; pointer-events:none; z-index:1; overflow:hidden; }
    .balloon{ position:absolute; font-size: clamp(22px, 4vw, 42px); filter: drop-shadow(0 8px 14px #0006);
      animation: floatUp var(--dur, 12s) linear infinite; left: var(--x,50%);
      transform: translateX(-50%);
    }
    @keyframes floatUp { from{ bottom:-10%; } to{ bottom:110%; } }

    #confetti{ position:fixed; inset:0; pointer-events:none; z-index:3 }

    footer{opacity:.75; text-align:center; font-size:12px; margin-top:10px}
    .tiny{font-size:12px; opacity:.9}

    /* Tap overlay for mobile-safe audio */
    #overlay{ position:fixed; inset:0; display:grid; place-items:center; background:rgba(10,10,18,.6); backdrop-filter: blur(4px); color:#fff; z-index:10; transition:opacity .25s ease; }
    #overlay.hidden{ opacity:0; pointer-events:none; }
    .bubble{ text-align:center; padding:16px 20px; background:#ffffff10; border:1px solid #ffffff30; border-radius:16px; font-size:clamp(16px,3.2vw,20px); box-shadow:0 12px 36px #0008 }
    .hint{ font-size:12px; opacity:.85; margin-top:6px }
    .pulse{ animation:pulse 1.3s infinite ease-in-out; display:inline-block }
    @keyframes pulse{ 0%,100%{ transform:scale(1)} 50%{ transform:scale(1.06)} }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>
  <div class="stars" id="stars"></div>
  <div class="balloons" id="balloons"></div>

  <!-- One-time tap/click overlay to satisfy mobile autoplay policies -->
  <div id="overlay">
    <div class="bubble">
      <div class="pulse">Tap anywhere to start the music üé∂</div>
      <div class="hint">Place your file as <strong>song1.mp3</strong> next to this HTML</div>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <h1>üéâ Happy Birthday, Grace!</h1>
      <p class="subtitle">Launch confetti, float balloons, and blow out the candles.</p>

      <div class="row controls">
        <button id="celebrate">üéä Celebrate</button>
        <button id="balloonBtn">üéà Balloons</button>
        <button id="blow">üïØÔ∏è Blow Candles</button>
        <button id="reset">‚Ü∫ Reset</button>
      </div>

      <p class="message" id="message">Happy Birthday, Grace!<span class="caret">|</span></p>

      <div class="stage" aria-label="Birthday cake">
        <svg viewBox="0 0 600 340" role="img" aria-labelledby="cakeTitle cakeDesc">
          <title id="cakeTitle">Birthday Cake</title>
          <desc id="cakeDesc">A layered cake with five candles, animated flames that can be blown out.</desc>
          <ellipse cx="300" cy="310" rx="220" ry="18" fill="#1b1b2f" opacity=".6"/>
          <rect x="120" y="210" width="360" height="90" rx="22" fill="#f7c9b6"/>
          <rect x="120" y="210" width="360" height="40" fill="#f5a9b8" opacity=".7"/>
          <rect x="160" y="150" width="280" height="70" rx="18" fill="#ffe9c9"/>
          <rect x="160" y="150" width="280" height="28" fill="#ffd166" opacity=".9"/>
          <path d="M160 178 q20 20 0 40 q30 -8 18 -32 q25 18 14 -8 q26 30 16 -6 q20 18 16 -8 q28 18 14 -10" fill="#ffd166" opacity=".95"/>
          <g fill="#ef476f">
            <circle cx="210" cy="200" r="4"/><circle cx="260" cy="195" r="4"/><circle cx="310" cy="202" r="4"/>
            <circle cx="360" cy="196" r="4"/><circle cx="400" cy="203" r="4"/>
          </g>
          <g id="candles">
            <g transform="translate(210,120)">
              <rect x="-8" y="0" width="16" height="40" rx="3" fill="#06d6a0"/>
              <ellipse cx="0" cy="-4" rx="4" ry="6" fill="#333"/>
              <path class="flame" d="M0 -22 c-6 10 -6 22 0 26 c6 -4 6 -16 0 -26z" fill="#ffd166"/>
            </g>
            <g transform="translate(260,118)">
              <rect x="-8" y="0" width="16" height="42" rx="3" fill="#118ab2"/>
              <ellipse cx="0" cy="-4" rx="4" ry="6" fill="#333"/>
              <path class="flame" d="M0 -22 c-6 10 -6 22 0 26 c6 -4 6 -16 0 -26z" fill="#ffd166"/>
            </g>
            <g transform="translate(300,116)">
              <rect x="-8" y="0" width="16" height="44" rx="3" fill="#ef476f"/>
              <ellipse cx="0" cy="-4" rx="4" ry="6" fill="#333"/>
              <path class="flame" d="M0 -22 c-6 10 -6 22 0 26 c6 -4 6 -16 0 -26z" fill="#ffd166"/>
            </g>
            <g transform="translate(340,118)">
              <rect x="-8" y="0" width="16" height="42" rx="3" fill="#ffd166"/>
              <ellipse cx="0" cy="-4" rx="4" ry="6" fill="#333"/>
              <path class="flame" d="M0 -22 c-6 10 -6 22 0 26 c6 -4 6 -16 0 -26z" fill="#ffd166"/>
            </g>
            <g transform="translate(390,120)">
              <rect x="-8" y="0" width="16" height="40" rx="3" fill="#a66cff"/>
              <ellipse cx="0" cy="-4" rx="4" ry="6" fill="#333"/>
              <path class="flame" d="M0 -22 c-6 10 -6 22 0 26 c6 -4 6 -16 0 -26z" fill="#ffd166"/>
            </g>
          </g>
        </svg>
      </div>

      <footer class="tiny">Tip: press <strong>C</strong> for confetti, <strong>B</strong> for balloons, and <strong>Space</strong> to blow out candles.</footer>
    </div>
  </div>

  <!-- Hidden audio element that will play in the background after the first user gesture -->
  <audio id="customSong" src="song1.mp3" preload="auto" loop></audio>
  <canvas id="confetti"></canvas>

  <script>
    // ===== Utility: Stars Background =====
    (function makeStars(){
      const stars = document.getElementById('stars');
      const N = 120;
      for(let i=0;i<N;i++){
        const s = document.createElement('span');
        s.style.left = Math.random()*100 + 'vw';
        s.style.top  = Math.random()*100 + 'vh';
        s.style.opacity = (0.4 + Math.random()*0.6).toFixed(2);
        s.style.setProperty('--delay', (Math.random()*6).toFixed(2)+'s');
        stars.appendChild(s);
      }
    })();

    // ===== Balloons =====
    const balloonsBox = document.getElementById('balloons');
    const balloonEmojis = ['üéà','üéà','üéà','üéà','üéâ','üéä'];
    function launchBalloons(count=18){
      for(let i=0;i<count;i++){
        const b = document.createElement('div'); b.className='balloon';
        b.textContent = balloonEmojis[Math.floor(Math.random()*balloonEmojis.length)];
        b.style.setProperty('--x', Math.random()*100 + 'vw');
        b.style.setProperty('--dur', (9+Math.random()*8).toFixed(2)+'s');
        b.style.animationDelay = (Math.random()*2).toFixed(2)+'s';
        balloonsBox.appendChild(b);
        setTimeout(()=> b.remove(), 16000);
      }
    }
    document.getElementById('balloonBtn').addEventListener('click', ()=>launchBalloons());

    // ===== Candles: blow out (toggle flames) =====
    const flames = [...document.querySelectorAll('.flame')];
    function blowCandles(off=true){ flames.forEach(f=> f.classList.toggle('off', off)); }
    document.getElementById('blow').addEventListener('click', ()=> blowCandles(true));
    document.getElementById('reset').addEventListener('click', ()=> { blowCandles(false); });

    // ===== Confetti (simple canvas particles) =====
    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    const DPR = Math.max(1, Math.min(2, window.devicePixelRatio||1));
    let confettiPieces = [];

    function resize(){
      canvas.width = Math.floor(innerWidth*DPR);
      canvas.height = Math.floor(innerHeight*DPR);
      ctx.setTransform(DPR,0,0,DPR,0,0);
    }
    addEventListener('resize', resize); resize();

    function addConfetti(n=180){
      for(let i=0;i<n;i++){
        confettiPieces.push({
          x: Math.random()*innerWidth,
          y: -20-Math.random()*innerHeight*.3,
          r: 4+Math.random()*6,
          c: ['#ffd166','#ef476f','#06d6a0','#118ab2','#f7f7ff'][Math.floor(Math.random()*5)],
          vx: -2+Math.random()*4,
          vy: 2+Math.random()*3,
          rot: Math.random()*Math.PI,
          vr: -0.1+Math.random()*0.2,
        });
      }
      if(!animating) animate();
    }
    let animating=false;
    function animate(){
      animating=true;
      ctx.clearRect(0,0,innerWidth,innerHeight);
      confettiPieces = confettiPieces.filter(p=> p.y < innerHeight+30);
      for(const p of confettiPieces){
        p.x += p.vx; p.y += p.vy; p.rot += p.vr;
        ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot);
        ctx.fillStyle = p.c; ctx.fillRect(-p.r, -p.r, p.r*2, p.r*2);
        ctx.restore();
      }
      if(confettiPieces.length){ requestAnimationFrame(animate); } else { animating=false; }
    }
    document.getElementById('celebrate').addEventListener('click', ()=> addConfetti());

    // ===== Keyboard shortcuts (no synth tune, no name set) =====
    addEventListener('keydown', (e)=>{
      if(e.target.matches('input, textarea')) return;
      if(e.code==='KeyC') addConfetti();
      if(e.code==='KeyB') launchBalloons();
      if(e.code==='Space'){ e.preventDefault(); blowCandles(true); }
    });

    // Little auto-festive start
    setTimeout(()=>{ addConfetti(120); launchBalloons(12); }, 600);

    // ===== Mobile-safe background playback after first user interaction =====
    (function(){
      const audio = document.getElementById('customSong');
      const overlay = document.getElementById('overlay');
      let started = false;

      function startAudio(){
        if(started) return; started = true;
        audio.volume = 0.6;
        const playPromise = audio.play();
        if(playPromise && typeof playPromise.then === 'function'){
          playPromise.then(()=>{ overlay.classList.add('hidden'); })
          .catch(err=>{
            console.warn('Autoplay blocked:', err);
            overlay.querySelector('.hint')?.remove();
            const hint = document.createElement('div');
            hint.className = 'hint';
            hint.textContent = 'Tap again to allow audio.';
            overlay.querySelector('.bubble').appendChild(hint);
            audio.controls = true; // fallback so user can press play
          });
        } else {
          overlay.classList.add('hidden');
        }
      }

      const startEvents = ['pointerdown','touchstart','click','keydown'];
      startEvents.forEach(ev => document.addEventListener(ev, startAudio, { once:true, passive:true }));

      document.addEventListener('visibilitychange', ()=>{
        if(!document.hidden && started && audio.paused){ audio.play().catch(()=>{}); }
      });
    })();
  </script>
</body>
</html>